<?xml version="1.0" encoding="UTF-8"?>

<queries>
    <query id="getUserNameFullNameSelVals">
        <description>
            Get select values for user name and full names.
        </description>
        <statement>
            SELECT
                CONCAT(u.frst_nam, " ", u.lst_nam) as TEXT,
                u.usr_nam as VALUE
            FROM sparrow_db.usr u
        </statement>
    </query>
    <query id="changeEmail">
        <description>
            Change email.
        </description>
        <statement>
            UPDATE SPARROW_DB.USR u SET u.eml = ? WHERE u.usr_id = ?
        </statement>
    </query>
    <query id="getUserNameCount">
        <description>
            Get the count of existing user names
        </description>
        <statement>
            SELECT
                count(u.usr_nam)
            FROM SPARROW_DB.USR u
            WHERE u.usr_nam = ?
        </statement>
    </query>
    <query id="changeUserName">
        <description>
            Change user name of a user
        </description>
        <statement>
            UPDATE SPARROW_DB.USR u
                SET u.USR_NAM = ?
            WHERE u.USR_ID = ?
        </statement>
    </query>
    <query id="getEmailReceiverDetails" >
        <description>Get Email receiver details</description>
        <statement>
            SELECT
                u.usr_id,
                u.frst_nam,
                u.lst_nam,
                u.eml
            FROM SPARROW_DB.usr u
            WHERE u.usr_id IN ( ? )
        </statement>
    </query>
    <query id="saveSongOrderToPlaylist" >
        <description>Maps song orders to playlist</description>
        <statement>
            INSERT INTO plylst_sng_ordrs(PLYLST_ID, SNG_ORDR_ID)
            VALUES(?, ?)
        </statement>
    </query>
    <query id="playlistPagination" >
        <description>playlist pagination query</description>
        <statement>
            SELECT * FROM SPARROW_DB.PLYLST p
            WHERE p.PLYLST_NAME LIKE '%Tally%'
            LIMIT :limit OFFSET :offset
        </statement>
    </query>
    <query id="logicallyDeleteEvent" >
        <description>Sets delete and show flags to Y</description>
        <statement>
            UPDATE SPARROW_DB.EVNT e
            SET e.DLTD = 'Y', e.SHW = 'N', e.UPDTD_BY = ?, e.LST_UPDT = sysdate()
            WHERE e.EVNT_ID = ?
        </statement>
    </query>
    <query id="hideOrReleaseEventToPublic" >
        <description>Sets show flag to Y</description>
        <statement>
            UPDATE SPARROW_DB.EVNT e
            SET e.SHW = ?
            WHERE e.EVNT_ID = ?
        </statement>
    </query>
    <query id="addEventAttendant" >
        <description>Registers an attendance of an event</description>
        <statement>
            INSERT INTO SPARROW_DB.EVNT_ATTNDNTS (EVNT_ID, USR_ID)
            VALUES (?, ?)
        </statement>
    </query>
    <query id="songPlaylistCount" >
        <description>Gets the number of playlists the song is part of</description>
        <statement>
            SELECT
                COUNT(*)
            FROM SPARROW_DB.PLYLST_SNGS ps
            WHERE ps.SNG_ID = ?
        </statement>
    </query>
    <query id="isUserEmailConfirmed" >
        <description>Check is email is confirmed.</description>
        <statement>
            SELECT u.EML_CNFRMD FROM SPARROW_DB.USR u WHERE u.USR_ID = ?
        </statement>
    </query>
    <query id="getSongOrdersForPlaylist" >
        <description>Retrieve song orders for playlist</description>
        <statement>
            SELECT
                pso.PLYLST_ID,
                so.SNG_ID,
                pso.SNG_ORDR_ID,
                so.SNG_INDX,
                so.USR_ID
            FROM
                PLYLST_SNG_ORDRS pso,
                PLYLST_SNGS ps,
                SNG_ORDR so
            WHERE pso.PLYLST_ID = ?
            AND pso.PLYLST_ID = ps.PLYLST_ID
            AND so.SNG_ID = ps.SNG_ID
            AND so.SNG_ORDR_ID = pso.SNG_ORDR_ID
            ORDER BY 1,2 asc
        </statement>
    </query>
</queries>